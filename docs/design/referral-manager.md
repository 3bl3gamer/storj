
# Title: Referral Manager

## Abstract

Right now, referral program only works per satellite meaning a user on us-east-1 satellite can only refer people to join us-ease-1. 
However, it's crucial for the tardigrade branded network to be able to handle cross-satellite referrals. Therefore, we plan to have a program running in
GCP along with tardigrade satellites to handle this issue.

## Background

Along with cross-satellite referrals, we are also working on having a sign-up page that will allow users to select which satellite
they would like to register an account with. Below design is built based on the new sign-up flow.

## Design

####Definition
*Referral Link* - _A static link that contains a unique referral code_

*Referral Code* - _An uuid generated by referral manager program for each user to be able to participate in our referral program_

#### User Flow
1. Sign up

    After a user clicks on the create account button:
    - Satellite sends a request to referral manager for a referral code and store that code along with the user information inside the user table.
    - If the user signed up through a referral link, satellite will also store the referrer's referral code in user_credits table under referred_by column.
    - After generating a unique referral code, referral manager will store that code along with the satellite id into its own database and send the code back to satellite.

2. Award referrer credits
    
    After invitee has used up their free credits:
    
    - Satellite will send a request with the referral code from referred_by 
    - Referral manager looks up the referrer's satellite id by referral code
    - Referral manager sends the referral code to the satellite to inform the referrer credits can be issued
            
## Rationale
1. Will this overload satellites?
2. Should we just have satellites communicate with each other directly? 

## Implementation
#### Requirements:

1. The referral manager program should use node id authentication to make sure that the node id the referral manager is talking to is one of our approved satellites


## Open issues (if applicable)
1. Should we also store referral offers information in referral manager so all tardigrade satellites will have the same
offer running? What technical concerns that would arise?
